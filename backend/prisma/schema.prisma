generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Business {
  id            String        @id @default(uuid())
  name          String
  businessName  String
  businessEmail String        @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  salaryConfig  SalaryConfig?
  employees     Employee[]
  payments      Payment[]
}

model SalaryConfig {
  id                String   @id @default(uuid())
  calculationMethod String   // 'calendar_month' | 'fixed_30_days' | 'exclude_weekly_offs'
  shiftHours        Int      @default(8)
  shiftMinutes      Int      @default(0)

  businessId        String   @unique
  business          Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
}

model Employee {
  id              String   @id @default(uuid())
  type            String   // 'full_time' | 'contract'
  fullName        String
  companyId       String
  phoneNumber     String
  dob             String
  gender          String
  salaryCycleDate Int
  salaryAccess    String
  wageType        String?  // 'Monthly' | 'Daily' | 'Per Hour Basis'
  salaryAmount    String?
  weeklyOffs      String   @default("[]") // JSON array stored as string
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  businessId      String
  business        Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  shiftId         String?
  shift           Shift?   @relation(fields: [shiftId], references: [id], onDelete: SetNull)

  payments        Payment[]

  @@index([businessId])
  @@index([shiftId])
}

model Shift {
  id            String     @id @default(uuid())
  name          String
  type          String     // 'fixed' | 'open' | 'rotational'
  startTime     String     // e.g., "09:00"
  endTime       String     // e.g., "18:00"
  breakMinutes  Int        @default(0)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  employees     Employee[]
}

model Payment {
  id                String   @id @default(uuid())
  type              String   // 'one-time' | 'advance' | 'salary'
  amount            Float
  paymentMode       String   // 'Cash' | 'UPI' | 'Bank Transfer'
  phoneNumber       String?  // Phone number for UPI/Bank Transfer
  upiId             String?  // UPI ID for UPI payments
  narration         String?  // Optional description/reason
  status            String   @default("completed") // 'pending' | 'completed' | 'failed'
  date              String   // Formatted date string
  razorpayPayoutId  String?  // Razorpay payout transaction ID
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  employeeId        String
  employee          Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  businessId        String
  business          Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([businessId])
  @@index([type])
  @@index([status])
}

